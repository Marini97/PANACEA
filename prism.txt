// Turn-based stochastic multi-player games
smg

// Players
player attacker
	attacker,
	[exfiltrateData], [exfiltrateData], [bufferOverflow], [getLoginData], [bribe], [searchOffice], [pathTraversal], [getFiles], [webRecon], [pathTraversal], [webRecon]
endplayer
player defender
	defender,
	[changeCredentials], [updateMySQL], [deactivateDOCKS5Proxy], [protectFiles], [rebootMySQL], [], [updateApache], [disableCGIscripts], [reconfigureApache], [installMySQL], [backupMySQL], [rebootApache], [], [updateApache], [disableCGIscripts], [checkMySQLUpdates], [installApache], [backupApache], [rebootApache], [], [checkApacheUpdates], [installApache], [backupApache], [checkApacheUpdates]
endplayer

global sched : [1..2];

// attacker goal
global DataExfiltration : bool;
label "terminate" = DataExfiltration=true;

// global variables
global AccesstoReverseShell : bool;
global Reconnaissance : bool;
global AccesstoMySQL : bool;
global AccesstoSensitiveFiles : bool;
global ExecuteArbitraryCode : bool;

// initial state
global MySQLServerVersion : bool init true;
global CGIscriptsenabled : bool init true;
global ApacheHTTPServerVersion : bool init true;
global SOCKS5ProxyActive : bool init true;
global MisconfiguredApache : bool init true;

module attacker

	getLoginData : bool;
	exfiltrateData : bool;
	pathTraversal : bool;
	getFiles : bool;
	bribe : bool;
	bufferOverflow : bool;
	searchOffice : bool;
	webRecon : bool;

	[exfiltrateData] sched=1 & (ExecuteArbitraryCode | AccesstoMySQL) & !DataExfiltration & !DataExfiltration & !exfiltrateData -> (DataExfiltration'=true) & (exfiltrateData'=true) & (sched'=2);
	[bufferOverflow] sched=1 & (MySQLServerVersion & AccesstoReverseShell & SOCKS5ProxyActive) & !DataExfiltration & !ExecuteArbitraryCode & !bufferOverflow -> (ExecuteArbitraryCode'=true) & (bufferOverflow'=true) & (sched'=2);
	[getLoginData] sched=1 & (SearchOffice | AccesstoSensitiveFiles | Bribe | ChangeCredentials) & !DataExfiltration & !AccesstoMySQL & !getLoginData -> (AccesstoMySQL'=true) & (getLoginData'=true) & (sched'=2);
	[bribe] sched=1 & (SearchOffice | AccesstoSensitiveFiles | Bribe | ChangeCredentials) & !DataExfiltration & !AccesstoMySQL & !bribe -> (AccesstoMySQL'=true) & (bribe'=true) & (sched'=2);
	[searchOffice] sched=1 & (SearchOffice | AccesstoSensitiveFiles | Bribe | ChangeCredentials) & !DataExfiltration & !AccesstoMySQL & !searchOffice -> (AccesstoMySQL'=true) & (searchOffice'=true) & (sched'=2);
	[pathTraversal] sched=1 & (CGIscriptsenabled & ApacheHTTPServerVersion & Reconnaissance) & !DataExfiltration & !AccesstoReverseShell & !pathTraversal -> (AccesstoReverseShell'=true) & (pathTraversal'=true) & (sched'=2);
	[getFiles] sched=1 & (MySQLServerVersion & AccesstoReverseShell & SOCKS5ProxyActive) & !DataExfiltration & !ExecuteArbitraryCode & !getFiles -> (ExecuteArbitraryCode'=true) & (getFiles'=true) & (sched'=2);
	[webRecon] sched=1 & (WebRecon) & !DataExfiltration & !Reconnaissance & !webRecon -> (Reconnaissance'=true) & (webRecon'=true) & (sched'=2);

endmodule


module defender

	UpdateMySQL bool;
	NewApacheVersion bool;
	BackupMySQL bool;
	InstalledNewMySQL bool;
	UpdateApache bool;
	BackupApache bool;
	InstalledNewApache bool;
	NewMySQLVersion bool;

	[changeCredentials] sched=2 & (SearchOffice | AccesstoSensitiveFiles | Bribe | ChangeCredentials) & !DataExfiltration & !AccesstoMySQL & -> (AccesstoMySQL'=true) & (sched'=1);
	[updateMySQL] sched=2 & (UpdateMySQL) & !DataExfiltration & !MySQLServerVersion & -> (MySQLServerVersion'=true) & (sched'=1);
	[deactivateDOCKS5Proxy] sched=2 & (DeactivateDOCKS5proxy) & !DataExfiltration & !SOCKS5ProxyActive & -> (SOCKS5ProxyActive'=true) & (sched'=1);
	[protectFiles] sched=2 & (ProtectFiles & AccesstoReverseShell & MisconfiguredApache) & !DataExfiltration & !AccesstoSensitiveFiles & -> (AccesstoSensitiveFiles'=true) & (sched'=1);
	[rebootMySQL] sched=2 & (InstalledNewMySQL & BackupMySQL) & !DataExfiltration & !UpdateMySQL & -> (UpdateMySQL'=true) & (sched'=1);
	[updateApache] sched=2 & (UpdateApache) & !DataExfiltration & !ApacheHTTPServerVersion & -> (ApacheHTTPServerVersion'=true) & (sched'=1);
	[disableCGIscripts] sched=2 & (DisableCGIscripts) & !DataExfiltration & !CGIscriptsenabled & -> (CGIscriptsenabled'=true) & (sched'=1);
	[reconfigureApache] sched=2 & (ReconfigureApache) & !DataExfiltration & !MisconfiguredApache & -> (MisconfiguredApache'=true) & (sched'=1);
	[installMySQL] sched=2 & (NewMySQLVersion) & !DataExfiltration & !InstalledNewMySQL & -> (InstalledNewMySQL'=true) & (sched'=1);
	[backupMySQL] sched=2 & (CreateBackupMySQL) & !DataExfiltration & !BackupMySQL & -> (BackupMySQL'=true) & (sched'=1);
	[rebootApache] sched=2 & (BackupApache & InstalledNewApache) & !DataExfiltration & !UpdateApache & -> (UpdateApache'=true) & (sched'=1);
	[checkMySQLUpdates] sched=2 & (CheckforMySQLUpdates) & !DataExfiltration & !NewMySQLVersion & -> (NewMySQLVersion'=true) & (sched'=1);
	[installApache] sched=2 & (NewApacheVersion) & !DataExfiltration & !InstalledNewApache & -> (InstalledNewApache'=true) & (sched'=1);
	[backupApache] sched=2 & (CreateBackupApache) & !DataExfiltration & !BackupApache & -> (BackupApache'=true) & (sched'=1);
	[checkApacheUpdates] sched=2 & (CheckforApacheUpdates) & !DataExfiltration & !NewApacheVersion & -> (NewApacheVersion'=true) & (sched'=1);

endmodule

rewards "attacker"

	[exfiltrateData] true : 50;
	[bufferOverflow] true : 30;
	[getLoginData] true : 10;
	[bribe] true : 500;
	[searchOffice] true : 500;
	[pathTraversal] true : 20;
	[getFiles] true : 30;
	[webRecon] true : 5;

endrewards

rewards "defender"

	[changeCredentials] true : 70;
	[updateMySQL] true : 10;
	[deactivateDOCKS5Proxy] true : 50;
	[protectFiles] true : 25;
	[rebootMySQL] true : 30;
	[updateApache] true : 10;
	[disableCGIscripts] true : 50;
	[reconfigureApache] true : 30;
	[installMySQL] true : 20;
	[backupMySQL] true : 50;
	[rebootApache] true : 30;
	[checkMySQLUpdates] true : 5;
	[installApache] true : 20;
	[backupApache] true : 50;
	[checkApacheUpdates] true : 5;

endrewards

